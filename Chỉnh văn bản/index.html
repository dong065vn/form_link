<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PasteCleaner ‚Äî S·ª≠a l·ªói d√°n t·ª´ Web/PDF sang Word</title>
  <style>
    :root {
      --bg: #0b1220;
      --text: #eef2ff;
      --muted: #94a3b8;
      --card: #0f172a;
      --accent: #38bdf8;
      --ok: #22c55e;
      --warn: #f59e0b;
      --danger: #ef4444;
      --border: #1f2937;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      background: linear-gradient(180deg, #0b1220, #0b1220 30%, #0d1325);
      color: var(--text);
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Inter, Arial, sans-serif;
      line-height: 1.6;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px;
    }
    
    /* Header */
    header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    
    h1 {
      font-size: 26px;
      letter-spacing: 0.3px;
      font-weight: 700;
    }
    
    .badge {
      font-size: 12px;
      font-weight: 600;
      color: #0b1220;
      background: var(--accent);
      padding: 4px 10px;
      border-radius: 999px;
    }
    
    .header-desc {
      color: var(--muted);
      font-size: 14px;
    }
    
    /* Card */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
    }
    
    .card-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-title-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background: var(--accent);
      color: #0b1220;
      border-radius: 50%;
      font-size: 14px;
      font-weight: 700;
    }
    
    /* Grid Layout */
    .grid {
      display: grid;
      gap: 16px;
    }
    
    @media (min-width: 980px) {
      .grid {
        grid-template-columns: 1.2fr 1fr;
      }
    }
    
    /* Textarea */
    textarea {
      width: 100%;
      min-height: 320px;
      max-height: 60vh;
      background: #0a1020;
      color: var(--text);
      border: 1px solid #1f2a44;
      border-radius: 12px;
      padding: 14px;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
      font-family: inherit;
    }
    
    textarea:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    textarea::placeholder {
      color: var(--muted);
      opacity: 0.6;
    }
    
    /* Controls */
    .controls {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 16px;
    }
    
    @media (min-width: 600px) {
      .controls {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    label {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      background: #0a1020;
      border: 1px solid #1e293b;
      padding: 12px;
      border-radius: 10px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    label:hover {
      border-color: #334155;
      background: #0d1425;
    }
    
    input[type="checkbox"] {
      margin-top: 2px;
      cursor: pointer;
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }
    
    /* Buttons */
    .btn-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 16px;
    }
    
    button {
      background: #111827;
      border: 1px solid #1f2937;
      color: var(--text);
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
      font-family: inherit;
    }
    
    button:hover {
      border-color: #374151;
      background: #1a202e;
    }
    
    button:active {
      transform: scale(0.98);
    }
    
    .primary {
      background: var(--accent);
      color: #0b1220;
      border-color: transparent;
    }
    
    .primary:hover {
      background: #0ea5e9;
    }
    
    .ok {
      background: var(--ok);
      color: #03140a;
      border-color: transparent;
    }
    
    .ok:hover {
      background: #16a34a;
    }
    
    .danger {
      background: var(--danger);
      color: #180405;
      border-color: transparent;
    }
    
    .danger:hover {
      background: #dc2626;
    }
    
    /* Stats */
    .stats {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 12px;
    }
    
    .pill {
      border: 1px solid #253047;
      border-radius: 999px;
      padding: 6px 12px;
      background: #0a1020;
      font-weight: 500;
    }
    
    /* Preview */
    .preview {
      white-space: pre-wrap;
      background: #0a1020;
      border: 1px dashed #26324a;
      padding: 14px;
      border-radius: 12px;
      min-height: 100px;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 12px;
      font-size: 13px;
      line-height: 1.6;
    }
    
    /* Footer */
    .footer {
      opacity: 0.7;
      font-size: 12px;
      margin-top: 12px;
      color: var(--muted);
      line-height: 1.5;
    }
    
    kbd {
      background: #1a202e;
      border: 1px solid #1f2937;
      border-bottom-width: 2px;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: ui-monospace, monospace;
      font-size: 11px;
    }
    
    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    }
    
    .muted {
      color: var(--muted);
    }
    
    /* Details/Summary */
    details {
      margin-top: 8px;
    }
    
    summary {
      cursor: pointer;
      padding: 12px;
      background: #0a1020;
      border-radius: 10px;
      list-style: none;
      user-select: none;
    }
    
    summary::-webkit-details-marker {
      display: none;
    }
    
    summary:hover {
      background: #0d1425;
    }
    
    details[open] summary {
      margin-bottom: 12px;
    }
    
    details p {
      padding: 12px;
      line-height: 1.8;
    }
    
    /* Toast */
    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 24px;
      padding: 12px 18px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 14px;
      z-index: 9999;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease-out;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }
    
    .text-center {
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>PasteCleaner</h1>
      <span class="badge">Web/PDF ‚Üí Word</span>
      <span class="header-desc">D·ªçn nhanh l·ªói khi Ctrl+C / Ctrl+V</span>
    </header>

    <div class="grid">
      <!-- LEFT: INPUT & ACTIONS -->
      <section class="card">
        <div class="card-title">
          <span class="card-title-number">1</span>
          D√°n vƒÉn b·∫£n v√†o ƒë√¢y
        </div>
        <div class="stats" id="statsTop"></div>
        <textarea id="input" placeholder="Ctrl+V n·ªôi dung t·ª´ Web ho·∫∑c PDF v√†o ƒë√¢y..." spellcheck="false"></textarea>
        
        <div class="btn-row">
          <button class="primary" id="btnClean">üßπ L√†m s·∫°ch</button>
          <button id="btnCopy">üìã Copy</button>
          <button id="btnDownload">üíæ T·∫£i .txt</button>
          <button id="btnUndo">‚Ü©Ô∏è Quay l·∫°i</button>
          <button class="danger" id="btnClear">üóëÔ∏è X√≥a</button>
        </div>
        
        <div class="footer">
          üí° <strong>M·∫πo:</strong> ƒê·ªÉ d√°n kh√¥ng ƒë·ªãnh d·∫°ng trong Word, d√πng 
          <kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>V</kbd> ‚Üí ch·ªçn <span class="mono">Unformatted Text</span>
        </div>
      </section>

      <!-- RIGHT: OPTIONS & PREVIEW -->
      <section class="card">
        <div class="card-title">
          <span class="card-title-number">2</span>
          T√πy ch·ªçn x·ª≠ l√Ω
        </div>
        
        <div class="controls">
          <label>
            <input type="checkbox" id="optStripHtml" checked>
            <span>B·ªè th·∫ª HTML / m√†u n·ªÅn</span>
          </label>
          <label>
            <input type="checkbox" id="optNbsp" checked>
            <span>ƒê·ªïi &nbsp; ‚Üí kho·∫£ng tr·∫Øng</span>
          </label>
          <label>
            <input type="checkbox" id="optTrimSpaces" checked>
            <span>Gom kho·∫£ng tr·∫Øng th·ª´a</span>
          </label>
          <label>
            <input type="checkbox" id="optFixLinebreaks" checked>
            <span>G·ªôp d√≤ng do PDF</span>
          </label>
          <label>
            <input type="checkbox" id="optRemoveBreaks">
            <span>X√≥a xu·ªëng d√≤ng ƒë∆°n</span>
          </label>
          <label>
            <input type="checkbox" id="optHyphen" checked>
            <span>G·ªôp t·ª´ ng·∫Øt d√≤ng (hyphen)</span>
          </label>
          <label>
            <input type="checkbox" id="optSmartQuotes" checked>
            <span>Chu·∫©n h√≥a d·∫•u ngo·∫∑c</span>
          </label>
          <label>
            <input type="checkbox" id="optBullets">
            <span>Chu·∫©n h√≥a bullet (‚Ä¢, ‚Äì, -)</span>
          </label>
          <label>
            <input type="checkbox" id="optUnwrapUrls" checked>
            <span>G·ªôp URL b·ªã ng·∫Øt d√≤ng</span>
          </label>
          <label>
            <input type="checkbox" id="optSplitSent">
            <span>T√°ch c√¢u th√†nh d√≤ng m·ªõi</span>
          </label>
          <label>
            <input type="checkbox" id="optRmCtl">
            <span>X√≥a k√Ω t·ª± ƒëi·ªÅu khi·ªÉn ·∫©n</span>
          </label>
        </div>

        <div class="btn-row">
          <button id="btnLower">abc vi·∫øt th∆∞·ªùng</button>
          <button id="btnUpper">ABC VI·∫æT HOA</button>
          <button id="btnSentence">Abc Vi·∫øt hoa ƒë·∫ßu c√¢u</button>
        </div>

        <div class="btn-row">
          <button id="btnShowPreview" class="ok">üëÅÔ∏è Xem tr∆∞·ªõc k·∫øt qu·∫£</button>
        </div>

        <div id="preview" class="preview" hidden></div>

        <div class="footer">
          ‚ö†Ô∏è C√¥ng c·ª• d√πng heuristic ƒë·ªÉ l√†m s·∫°ch nhanh, kh√¥ng ho√†n h·∫£o 100% cho m·ªçi t√†i li·ªáu ph·ª©c t·∫°p. C√≥ th·ªÉ ch·∫°y l·∫°i nhi·ªÅu l·∫ßn.
        </div>
      </section>
    </div>

    <!-- TIPS SECTION -->
    <section class="card">
      <details>
        <summary><strong>üìö M·∫πo & Regex hay d√πng (nh·∫•n ƒë·ªÉ xem)</strong></summary>
        <p class="muted">
          ‚Ä¢ <strong>Xu·ªëng d√≤ng theo c√¢u:</strong> Trong Word, thay ". " ‚Üí ". ^p"<br>
          ‚Ä¢ <strong>X√≥a hyperlink:</strong> Ch·ªçn t·∫•t c·∫£ ‚Üí <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>F9</kbd><br>
          ‚Ä¢ <strong>T√¨m d√≤ng tr·ªëng k√©p:</strong> T√¨m <code>\n\n+</code> ‚Üí thay b·∫±ng <code>\n\n</code><br>
          ‚Ä¢ <strong>TCVN3/VNI ‚Üí Unicode:</strong> N√™n d√πng Unikey Toolkit<br>
          ‚Ä¢ <strong>X√≥a s·ªë trang:</strong> T√¨m <code>^\d+$</code> (d√≤ng ch·ªâ c√≥ s·ªë) v√† x√≥a
        </p>
      </details>
    </section>

    <!-- FOOTER -->
    <div class="footer muted text-center" style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border);">
      ¬© 2024 PasteCleaner ‚Äî by D | üîí Ch·∫°y ho√†n to√†n local, kh√¥ng g·ª≠i d·ªØ li·ªáu ƒëi ƒë√¢u c·∫£
    </div>
  </div>

  <script>
    const $ = (selector) => document.querySelector(selector);
    const input = $('#input');
    const preview = $('#preview');
    const statsTop = $('#statsTop');

    let historyStack = [];

    const ABBRS = new Set([
      'tp', 'ts', 'ths', 'th.s', 'pgs', 'gs', 'pgs.ts', 
      'mr', 'mrs', 'dr', 'prof', 'vs', 'vd', 'v.d', 'v.v', 
      'e.g', 'i.e', 'etc', 'no', 'st', 'bt', 'q', 
      'tp.hcm', 'hn', 'usa', 'uk'
    ]);

    function updateStats(txt) {
      const chars = txt.length;
      const words = (txt.match(/\S+/g) || []).length;
      const lines = txt.split(/\n/).length;
      statsTop.innerHTML = `
        <span class="pill">${chars.toLocaleString('vi-VN')} k√Ω t·ª±</span>
        <span class="pill">${words.toLocaleString('vi-VN')} t·ª´</span>
        <span class="pill">${lines.toLocaleString('vi-VN')} d√≤ng</span>
      `;
    }

    function pushHistory() {
      historyStack.push(input.value);
      if (historyStack.length > 50) historyStack.shift();
    }

    function stripHTML(html) {
      html = html.replace(/<\s*br\s*\/?\s*>/gi, '\n');
      html = html.replace(/<\s*div\s*>/gi, '');
      html = html.replace(/<\s*\/div\s*>/gi, '\n');
      const tmp = document.createElement('div');
      tmp.innerHTML = html;
      return tmp.textContent || tmp.innerText || '';
    }

    function normalizeNbsp(text) {
      return text.replace(/\u00A0|&nbsp;/g, ' ');
    }

    function removeControlChars(text) {
      return text
        .replace(/[\u200B-\u200F\u202A-\u202E\u2066-\u2069\uFEFF]/g, '')
        .replace(/[\x00-\x08\x0B\x0C\x0E-\x1F]/g, '');
    }

    function smartToStraight(text) {
      return text
        .replace(/[""¬´¬ª]/g, '"')
        .replace(/[''‚Äö‚Äõ]/g, "'")
        .replace(/[‚Äì‚Äî]/g, '-')
        .replace(/‚Ä¶/g, '...');
    }

    function trimSpaces(text) {
      return text
        .replace(/[\t ]+/g, ' ')
        .replace(/ *\n */g, '\n')
        .replace(/\n{3,}/g, '\n\n')
        .replace(/^ +| +$/gm, '')
        .trim();
    }

    function fixPdfLinebreaks(text) {
      return text.replace(/([^.!?;:\-])\n(?!\n|\s*[\-‚Ä¢‚ó¶¬∑*]|\s*\d+\.)/g, '$1 ');
    }

    function mergeHyphenBreaks(text) {
      return text.replace(/([\p{L}0-9])-[\t ]*\n([\p{L}0-9])/gu, '$1$2');
    }

    function removeAllBreaks(text) {
      return text.replace(/\r\n?/g, '\n').replace(/\n(?!\n)/g, ' ');
    }

    function normalizeBullets(text) {
      return text
        .replace(/^\s*[‚Ä¢‚ó¶¬∑*]\s*/gm, '- ')
        .replace(/^(\s*)[‚Äì‚Äî-]\s*/gm, '$1- ')
        .replace(/^(\s*)\d+\)\s*/gm, '$1- ');
    }

    function unwrapLongUrls(text) {
      return text.replace(/(https?:\/\/\S+)\n(?=\S)/g, '$1');
    }

    function splitSentencesToNewlines(text) {
      return text.replace(/([.!?‚Ä¶]+)\s+(?=\p{L}|\d)/gu, (match, punct, offset, str) => {
        const back = str.slice(0, Math.max(0, offset)).split(/\s+/).pop() || '';
        const word = back.replace(/[^\p{L}\d\.]/gu, '').toLowerCase();
        if (ABBRS.has(word) || /\b\d+\.(\d+)+$/.test(back)) {
          return match;
        }
        return punct + '\n';
      });
    }

    function sentenceCase(text) {
      return text.replace(/(^|[\n\r]\s*)([^\n\r]+)/g, (match, start, line) => {
        return start + line.replace(/^([\p{L}])(.*)$/u, (m, first, rest) => {
          return first.toLocaleUpperCase('vi-VN') + rest;
        });
      });
    }

    function toUpper(text) {
      return text.toLocaleUpperCase('vi-VN');
    }

    function toLower(text) {
      return text.toLocaleLowerCase('vi-VN');
    }

    function clean() {
      pushHistory();
      let text = input.value;
      
      if ($('#optStripHtml').checked) {
        text = stripHTML(text);
      }
      if ($('#optNbsp').checked) {
        text = normalizeNbsp(text);
      }
      if ($('#optRmCtl').checked) {
        text = removeControlChars(text);
      }
      if ($('#optSmartQuotes').checked) {
        text = smartToStraight(text);
      }
      if ($('#optFixLinebreaks').checked) {
        text = fixPdfLinebreaks(text);
      }
      if ($('#optHyphen').checked) {
        text = mergeHyphenBreaks(text);
      }
      if ($('#optUnwrapUrls').checked) {
        text = unwrapLongUrls(text);
      }
      if ($('#optRemoveBreaks').checked) {
        text = removeAllBreaks(text);
      }
      if ($('#optBullets').checked) {
        text = normalizeBullets(text);
      }
      if ($('#optSplitSent').checked) {
        text = splitSentencesToNewlines(text);
      }
      if ($('#optTrimSpaces').checked) {
        text = trimSpaces(text);
      }
      
      input.value = text;
      updateStats(text);
      return text;
    }

    function showPreview() {
      const text = clean();
      preview.textContent = text;
      preview.hidden = false;
    }

    function toast(message, isError = false) {
      const toastEl = document.createElement('div');
      toastEl.className = 'toast';
      toastEl.textContent = message;
      toastEl.style.background = isError ? '#ef4444' : '#22c55e';
      toastEl.style.color = '#0b1220';
      document.body.appendChild(toastEl);
      setTimeout(() => toastEl.remove(), 2000);
    }

    // Event Listeners
    $('#btnClean').addEventListener('click', clean);
    
    $('#btnShowPreview').addEventListener('click', showPreview);
    
    $('#btnCopy').addEventListener('click', async () => {
      const text = clean();
      try {
        await navigator.clipboard.writeText(text);
        toast('‚úÖ ƒê√£ copy n·ªôi dung s·∫°ch');
      } catch (error) {
        toast('‚ùå Copy th·∫•t b·∫°i: tr√¨nh duy·ªát ch·∫∑n', true);
      }
    });
    
    $('#btnDownload').addEventListener('click', () => {
      const text = clean();
      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'cleaned_text.txt';
      a.click();
      URL.revokeObjectURL(url);
      toast('‚úÖ ƒê√£ t·∫£i file cleaned_text.txt');
    });
    
    $('#btnClear').addEventListener('click', () => {
      if (input.value && !confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô vƒÉn b·∫£n?')) {
        return;
      }
      input.value = '';
      updateStats('');
      preview.hidden = true;
      toast('üóëÔ∏è ƒê√£ x√≥a n·ªôi dung');
    });
    
    $('#btnUndo').addEventListener('click', () => {
      if (historyStack.length > 0) {
        input.value = historyStack.pop();
        updateStats(input.value);
        toast('‚Ü©Ô∏è ƒê√£ quay l·∫°i');
      } else {
        toast('‚ùå Kh√¥ng c√≥ thao t√°c tr∆∞·ªõc ƒë√≥', true);
      }
    });
    
    $('#btnLower').addEventListener('click', () => {
      pushHistory();
      input.value = toLower(input.value);
      updateStats(input.value);
    });
    
    $('#btnUpper').addEventListener('click', () => {
      pushHistory();
      input.value = toUpper(input.value);
      updateStats(input.value);
    });
    
    $('#btnSentence').addEventListener('click', () => {
      pushHistory();
      input.value = sentenceCase(input.value);
      updateStats(input.value);
    });
    
    input.addEventListener('input', () => updateStats(input.value));
    
    // Initialize
    updateStats('');
  </script>
</body>
</html>